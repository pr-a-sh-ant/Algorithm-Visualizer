#pragma once

#include "Node.h"
#include "Button.h"
#include <queue>
#include "App.h"
#include "Algorithm.h"
#include "Box.h"

class Box;
class Button;
class App;

class Search
{
private:
	int matrix_height = 28;
	int matrix_width = 28;
	int boxOrder = 40;
	Box *get_box(sf::Vector2i &pos);
	static inline std::vector<sf::Vector2i> defaultMaze = {{4,7},{4,8},{4,9},{4,10},{4,11},{4,12},{5,7},{5,13},{5,14},{5,15},{5,16},{5,17},{5,18},{5,19},{5,20},{5,21},{5,22},{5,23},{5,24},{5,25},{5,26},{5,27},{5,28},{5,29},{5,30},{5,31},{5,32},{5,33},{5,34},{5,35},{6,7},{6,10},{6,11},{6,12},{6,13},{6,14},{6,15},{6,16},{6,33},{6,35},{7,7},{7,10},{7,17},{7,18},{7,19},{7,33},{7,35},{8,7},{8,10},{8,20},{8,33},{8,35},{9,7},{9,10},{9,20},{9,33},{9,35},{10,7},{10,10},{10,20},{10,33},{10,35},{11,7},{11,10},{11,19},{11,33},{11,35},{12,7},{12,10},{12,19},{12,33},{12,35},{13,7},{13,10},{13,19},{13,30},{13,31},{13,32},{13,33},{13,35},{14,7},{14,10},{14,11},{14,17},{14,18},{14,19},{14,20},{14,21},{14,22},{14,23},{14,24},{14,25},{14,26},{14,27},{14,28},{14,29},{14,30},{14,35},{15,7},{15,12},{15,13},{15,14},{15,15},{15,16},{15,17},{15,18},{15,19},{15,31},{15,32},{15,33},{15,35},{16,7},{16,24},{16,25},{16,26},{16,27},{16,28},{16,29},{16,30},{16,31},{16,32},{16,33},{16,35},{17,7},{17,20},{17,21},{17,22},{17,23},{17,35},{18,7},{18,17},{18,18},{18,19},{18,20},{18,23},{18,24},{18,25},{18,26},{18,27},{18,28},{18,29},{18,30},{18,31},{18,32},{18,33},{18,35},{19,7},{19,11},{19,12},{19,13},{19,14},{19,15},{19,16},{19,17},{19,33},{19,35},{20,7},{20,11},{20,33},{20,35},{21,7},{21,11},{21,15},{21,16},{21,17},{21,26},{21,27},{21,28},{21,29},{21,30},{21,31},{21,32},{21,33},{21,35},{22,7},{22,11},{22,15},{22,17},{22,18},{22,19},{22,20},{22,27},{22,35},{23,7},{23,11},{23,15},{23,20},{23,21},{23,22},{23,23},{23,24},{23,25},{23,26},{23,27},{23,28},{23,29},{23,30},{23,31},{23,32},{23,33},{23,35},{24,7},{24,11},{24,15},{24,30},{24,35},{25,7},{25,11},{25,15},{25,30},{25,35},{26,7},{26,11},{26,15},{26,30},{26,35},{27,7},{27,11},{27,15},{27,30},{27,35},{28,7},{28,11},{28,15},{28,30},{28,35},{29,7},{29,11},{29,15},{29,30},{29,35},{30,7},{30,11}};

public:
	Search(App *app);
	~Search();
	App *app;
	Algorithm alg;

	sf::Vector2i origin = sf::Vector2i(25, 25);
	std::vector<std::vector<Box *>> box;
	std::vector<Button *> buttons;

	float totalTime = .0f;
	float switchTIme = .01f;
	bool searching = false;
	bool search_complete = false;
	bool back_propagating = false;

	// For search
	std::queue<sf::Vector2i> queue;
	std::vector<std::vector<bool>> visited;
	std::vector<std::vector<sf::Vector2i>> parents;
	std::vector<sf::Vector2i> maze;
	sf::Vector2i initial_state = sf::Vector2i(5, 5);
	sf::Vector2i final_state = sf::Vector2i(20, 20);
	sf::Vector2i back_state = final_state;
	sf::Text *textAlgo;
	Node *currentNode;

	void init_boxes();
	void init_buttons();
	void init();

	void update();
	void update_boxes();
	void update_buttons();

	void draw_boxes();
	void draw_buttons();
	void draw();

	void solve();
	void init_solve();

	void reset();
};
